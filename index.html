<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Macros</title>
    <base href="./" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="./icon/logo.jpg" />
    <link rel="stylesheet" href="./css/styles.css" />
    <link rel="stylesheet" href="./css/formErog.css" />
    <style>
      #msg {
        padding-left: 1em !important;
        padding-right: 1em !important;
      }
      .image-logo-macros {
        width: 350px;
      }
    </style>
  </head>
  <body class="access login">
    <app-root></app-root>
    <!--background-color: var(--sidebar-bg-color)!important;-->
    <div
      style="
        width: 100%;
        display: flex;
        justify-content: center;
        padding: 1em;
        align-items: center;
      "
      class="d-flex justify-content-center"
    >
      <img
        class="image-logo-macros"
        src="./icon/macros white.png"
        id="logo-macros"
        alt=""
        onclick="showModalService()"
      />
    </div>
    <section class="layout-container-wide">
      <div class="central-form-container h-80">
        <section class="access-form form-login">
          <div>
            <h1 class="input-lead" style="padding-bottom: 0.5em">DEMO KIT</h1>
            <!---------HAMBURGER----------->
            <a
              id="openmenu"
              class="hamburger-checkbox space-around"
              style="display: none"
            >
              <div class="hamburger-icon">
                <label for="openmenu" id="hamburger-label">
                  <div id="nav-icon">
                    <span></span><span></span><span></span>
                  </div>
                </label>
              </div>
            </a>
            <p class="input-lead" id="text-p">Create your own shake</p>
          </div>
          <script>
            document.addEventListener("DOMContentLoaded", (event) => {
              document
                .getElementById("openmenu")
                .addEventListener("click", function () {
                  document
                    .getElementById("sidebarServiceMenu")
                    .classList.add("opened");
                  document
                    .getElementById("sidebarServiceMenu")
                    .classList.remove("closed");
                  document.getElementById("sidebar_section").style.display =
                    "block";
                });

              document.getElementById("closemenu").onclick = function () {
                document
                  .getElementById("sidebarServiceMenu")
                  .classList.remove("opened");
                document
                  .getElementById("sidebarServiceMenu")
                  .classList.add("closed");
                document.getElementById("sidebar_section").style.display =
                  "none";
              };
            });
          </script>
          <!---------SECTION USER EXPERIENCE----------->
          <div style="padding: 0 !important" id="section-erogation">
            <span id="error-username" style="display: block"></span>
            <div class="input-container">
              <i class="input-icon"><img src="./icon/user.png" alt="" /></i>
              <input
                type="number"
                class="input-field input-lead"
                id="username"
                max="255"
                min="0"
                name="username"
                placeholder="User_id [0-255]"
                required
              />
            </div>
            <span id="error-water" style="display: block"></span>
            <div class="input-container">
              <i class="input-icon"><img src="./icon/water.png" alt="" /></i>
              <input
                type="number"
                class="input-field input-lead"
                id="water"
                max="500"
                min="0"
                step="1"
                name="water"
                placeholder="Water [ml]"
                required
              />
            </div>
            <span id="error-supplement" style="display: block"></span>
            <div class="input-container">
              <i class="input-icon"
                ><img src="./icon/supplement.png" alt=""
              /></i>
              <input
                type="number"
                class="input-field input-lead"
                id="supplement"
                max="100"
                min="0"
                step="1"
                name="supplement"
                placeholder="Supplement [gr]"
                required
              />
            </div>
            <span id="error-flavour" style="display: block"></span>
            <div class="input-container">
              <i class="input-icon"><img src="./icon/liquid.png" alt="" /></i>
              <input
                type="number"
                class="input-field input-lead"
                id="flavour"
                max="50"
                min="0"
                step="1"
                name="flavour"
                placeholder="Flavour [ml]"
                required
              />
            </div>
            <!---------BUTTON FOR EROGATION AND SEND----------->
            <div class="space-between" id="serial">
              <button
                id="cmd_0"
                class="btn btn-big btn-bg-primary btn-mobile-stretch"
                onclick="validateForm(0)"
              >
                Send recipe
              </button>
              <span
                class="btn btn-big btn-bg-primary btn-mobile-stretch"
                id="modalButton"
                onClick="OpenModal()"
                >Erogation</span
              >
            </div>
          </div>
          <!---------SECTION SERVICE----------->
          <div
            style="padding: 0 !important; display: none"
            id="section-service"
          >
            <!---------CLEAN AND FILL----------->
            <div style="display: block" id="service_mode">
              <h5
                style="
                  display: block;
                  text-transform: uppercase;
                  margin-bottom: 1em;
                  margin-top: 1.5em;
                "
              >
                clean
              </h5>
              <button
                class="btn btn-big btn-bg-primary btn-mobile-stretch"
                style="width: 350px"
                id="service_1"
                onclick="cleanAndFill('2','0','1')"
              >
                peristaltic pump
              </button>
              <button
                class="btn btn-big btn-bg-primary btn-mobile-stretch"
                style="width: 350px"
                id="service_2"
                onClick="cleanAndFill('2','1','2')"
              >
                spiral feeder
              </button>
              <hr />
              <h5
                style="
                  display: block;
                  text-transform: uppercase;
                  margin-bottom: 1em;
                "
              >
                fill
              </h5>
              <button
                class="btn btn-big btn-bg-secondary btn-mobile-stretch"
                style="width: 350px"
                id="service_3"
                onclick="cleanAndFill('3','0','3')"
              >
                peristaltic pump
              </button>
              <button
                class="btn btn-big btn-bg-secondary btn-mobile-stretch"
                style="width: 350px"
                id="service_4"
                onClick="cleanAndFill('3',1,'4')"
              >
                spiral feeder
              </button>
            </div>
            <!---------SUPPLEMENT SELECTION----------->
            <div style="display: none" id="supplement_selection">
              <h5
                style="
                  display: block;
                  text-transform: uppercase;
                  margin-bottom: 1em;
                  margin-top: 1.5em;
                "
              >
                supplement selection
              </h5>
              <button
                class="btn btn-big btn-bg-secondary btn-mobile-stretch"
                style="width: 350px"
                id="supplement_1"
                onclick="supplementSelection('5','1')"
              >
                vegan proteins
              </button>
              <button
                class="btn btn-big btn-bg-secondary btn-mobile-stretch"
                style="width: 350px"
                id="supplement_2"
                onClick="supplementSelection('5','2')"
              >
                mineral salts
              </button>
              <button
                class="btn btn-big btn-bg-secondary btn-mobile-stretch"
                style="width: 350px"
                id="supplement_3"
                onClick="supplementSelection('5','3')"
              >
                bcaa1
              </button>
              <button
                class="btn btn-big btn-bg-secondary btn-mobile-stretch"
                style="width: 350px"
                id="supplement_4"
                onClick="supplementSelection('5','4')"
              >
                bcaa2
              </button>
            </div>
            <!---------FLAVOUR SELECTION----------->
            <div style="display: none" id="flavour_selection">
              <h5
                style="
                  display: block;
                  text-transform: uppercase;
                  margin-bottom: 1em;
                  margin-top: 1.5em;
                "
              >
                flavour selection
              </h5>
              <button
                class="btn btn-big btn-bg-secondary btn-mobile-stretch"
                style="width: 350px"
                id="flavour_1"
                onclick="flavourSelection('7','1')"
              >
                chocolate
              </button>
              <button
                class="btn btn-big btn-bg-secondary btn-mobile-stretch"
                style="width: 350px"
                id="flavour_2"
                onClick="flavourSelection('7','2')"
              >
                Strawberry
              </button>
              <button
                class="btn btn-big btn-bg-secondary btn-mobile-stretch"
                style="width: 350px"
                id="flavour_3"
                onClick="flavourSelection('7','3')"
              >
                nutty
              </button>
              <button
                class="btn btn-big btn-bg-secondary btn-mobile-stretch"
                style="width: 350px"
                id="flavour_4"
                onClick="flavourSelection('7','4')"
              >
                caramel
              </button>
              <button
                class="btn btn-big btn-bg-secondary btn-mobile-stretch"
                style="width: 350px"
                id="flavour_5"
                onClick="flavourSelection('7','5')"
              >
                coconut
              </button>
            </div>
          </div>
          <hr />
          <!---------MESSAGE BOX----------->
          <div id="msg"></div>
          <div id="msg_usb"></div>

          <!---------MODAL COMMAND 1----------->
          <div id="modal" class="modal">
            <div class="modal-content animated bounce">
              <div class="modal-text">
                <h5>Confirm to erogation</h5>
                <div style="text-align: center">
                  <div>
                    <p><b>User_id:</b> <span id="modal-username"></span></p>
                  </div>
                  <div>
                    <p><b>Water:</b> <span id="modal-water"></span></p>
                  </div>
                  <div>
                    <p>
                      <b>Supplement:</b> <span id="modal-supplement"></span>
                    </p>
                  </div>
                  <div>
                    <p><b>Flavour:</b> <span id="modal-flavour"></span></p>
                  </div>
                </div>
                <span
                  class="btn btn-medium btn-bg-lighter"
                  onClick="CloseModal(0)"
                  >Go back</span
                >
                <button
                  id="cmd_1"
                  type="text"
                  class="btn btn-big btn-bg-primary btn-mobile-stretch"
                  onclick="validateForm(1)"
                >
                  Erogation
                </button>
              </div>
            </div>
          </div>

          <!---------SERVICE MODAL----------->
          <div id="modal_service" class="modal">
            <div class="modal-content animated bounce">
              <div class="modal-text">
                <h5>Enter password:</h5>
                <div>
                  <div class="input-container">
                    <i class="input-icon"
                      ><img src="./icon/password.svg" alt=""
                    /></i>
                    <input
                      type="password"
                      class="input-field input-lead"
                      id="password"
                      name="password"
                      placeholder="Password"
                      required
                    />
                  </div>
                  <span id="error-password" style="display: block"></span>
                </div>

                <span
                  class="btn btn-medium btn-bg-lighter"
                  onClick="CloseModal(1)"
                  >Go back</span
                >
                <button
                  id="enter_command"
                  type="text"
                  class="btn btn-big btn-bg-primary btn-mobile-stretch"
                  onclick="openServiceMode()"
                >
                  Enter
                </button>
                <script>
                  var input = document.getElementById("password");
                  input.addEventListener("keyup", function (event) {
                    // Number 13 is the "Enter" key on the keyboard
                    if (event.keyCode === 13) {
                      // Cancel the default action, if needed
                      event.preventDefault();
                      // Trigger the button element with a click
                      document.getElementById("enter_command").click();
                    }
                  });
                </script>
              </div>
            </div>
          </div>
        </section>
      </div>
      <!---------SIDEBAR----------->
      <div
        id="sidebar_section"
        class="sidebar_section"
        onclick="closemenu()"
      ></div>
      <div
        id="sidebarServiceMenu"
        class="sidebar layout-container-wide"
        style="display: none !important"
      >
        <div class="mobile-header">
          <div class="space-between" style="align-items: center">
            <h4 class="site-logo-text logo-text-small">Service Mode</h4>
            <span id="closemenu" class="icon">
              <img src="./icon/x.svg" alt="" />
            </span>
          </div>
        </div>
        <ul>
          <button
            class="btn btn-medium btn-bg-primary btn-mobile-stretch"
            style="width: 250px"
            id="cleanFillButtonMode"
            onclick="serviceSidebar('sm')"
          >
            clean/fill
          </button>
          <button
            class="btn btn-medium btn-bg-primary btn-mobile-stretch"
            style="width: 250px"
            id="supplementButtonMode"
            onClick="serviceSidebar('ss')"
          >
            supplement selection
          </button>
          <button
            class="btn btn-medium btn-bg-primary btn-mobile-stretch"
            style="width: 250px"
            id="flavourButtonMode"
            onclick="serviceSidebar('fs')"
          >
            flavour selection
          </button>
          <hr />
          <button
            class="btn btn-big btn-bg-primary btn-bg-lighter btn-mobile-stretch"
            style="width: 250px !important"
            onClick="closeServiceMode()"
          >
            Go back
          </button>
        </ul>
      </div>
    </section>
    <!---------LOADER----------->
    <div id="loader">
      <div>
        <div class="bars-cont bars-cont">
          <div class="load-bar"></div>
          <div class="load-bar"></div>
          <div class="load-bar"></div>
          <div class="load-bar"></div>
          <div class="load-bar"></div>
          <div class="load-bar"></div>
          <div class="load-bar"></div>
          <div class="load-bar"></div>
          <div class="load-bar"></div>
        </div>
        <hr />
        <div class="">
          <h4 style="color: var(--macros-color)">Erogation in progress!</h4>
        </div>
      </div>
    </div>

    <script>
      function showLoader() {
        let bars = document.querySelectorAll(".load-bar");
        for (let i = 0; i < bars.length; i++) {
          bars[i].style.animationDelay = `${i / 15}s`;
        }
        document.getElementById("loader").classList.add("show-loader");
      }
      function closeLoader() {
        document.getElementById("loader").classList.remove("show-loader");
      }

      function OpenModal() {
        var modal = document.getElementById("modal");
        modal.style.display = "grid";
        var user_id = document.getElementById("username").value;
        var water = document.getElementById("water").value;
        user_id.textContent = user_id;
        var supplement = document.getElementById("supplement").value;
        user_id.textContent = user_id;
        var flavour = document.getElementById("flavour").value;
        user_id.textContent = user_id;
        if (user_id != "") {
          document.getElementById("modal-username").textContent = user_id;
        } else {
          document.getElementById("modal-username").textContent =
            "not speciefied";
        }
        if (water != "") {
          document.getElementById("modal-water").textContent = water;
        } else {
          document.getElementById("modal-water").textContent = "not speciefied";
        }
        if (supplement != "") {
          document.getElementById("modal-supplement").textContent = supplement;
        } else {
          document.getElementById("modal-supplement").textContent =
            "not speciefied";
        }
        if (flavour != "") {
          document.getElementById("modal-flavour").textContent = flavour;
        } else {
          document.getElementById("modal-flavour").textContent =
            "not speciefied";
        }
      }
      function CloseModal(e) {
        if (e == 0) {
          var modal = document.getElementById("modal");
          modal.style.display = "none";
        } else {
          var modal = document.getElementById("modal_service");
          modal.style.display = "none";
          document
            .getElementById("error-password")
            .classList.remove("alert-danger-service");
          document.getElementById("error-password").textContent = "";
          document.getElementById("password").value = "";
        }
      }

      function showModalService() {
        var modal_service = document.getElementById("modal_service");
        modal_service.style.display = "grid";
      }

      function closemenu() {
        document
          .getElementById("sidebarServiceMenu")
          .classList.remove("opened");
        document.getElementById("sidebarServiceMenu").classList.add("closed");
        document.getElementById("sidebar_section").style.display = "none";
      }

      async function schedulerSerialport() {
        await serialport.list().then((ports, err) => {
          if (err) {
            console.log(err);
            return;
          }
          //console.log('ports', ports);

          if (ports.length === 0) {
            document.getElementById("msg_usb").classList.remove("alert-danger");
            document.getElementById("msg_usb").classList.add("alert-danger");
            document.getElementById("msg_usb").textContent =
              "USB not connected!";
            document.getElementById("serial").style.display = "none";
            console.log("No ports discovered");
          }

          ports.forEach(function (port) {
            if (port.manufacturer == "FTDI") {
              //serports.push(port.path);
              if (port.serialNumber == "AC01P2CA") {
                document
                  .getElementById("msg_usb")
                  .classList.remove("alert-danger");
                document.getElementById("msg_usb").textContent = "";
                document.getElementById("serial").style.display = "flex";
                document
                  .getElementById("supplementButtonMode")
                  .removeAttribute("disabled");
                document
                  .getElementById("cleanFillButtonMode")
                  .removeAttribute("disabled");
                document
                  .getElementById("flavourButtonMode")
                  .removeAttribute("disabled");
              } else {
                document
                  .getElementById("msg_usb")
                  .classList.add("alert-danger");
                document.getElementById("msg_usb").textContent =
                  "USB not connected!";
                document.getElementById("serial").style.display = "none";
                //document.getElementById("supplementButtonMode").disabled="true";document.getElementById("cleanFillButtonMode").disabled="true";
                //document.getElementById("flavourButtonMode").disabled="true";

                //document.getElementById("msg").classList.remove("alert-danger"); document.getElementById("msg").textContent = "";
                //document.getElementById("msg").classList.remove("alert-success");
              }
            } else {
              document.getElementById("msg_usb").classList.add("alert-danger");
              document.getElementById("msg_usb").textContent =
                "USB not connected!";
              document.getElementById("serial").style.display = "none";
              //document.getElementById("supplementButtonMode").disabled="true";document.getElementById("cleanFillButtonMode").disabled="true";
              //document.getElementById("flavourButtonMode").disabled="true";
            }
          });
        });
      }
      setTimeout(function listPorts() {
        schedulerSerialport();
        setTimeout(listPorts, 100);
      }, 100);
    </script>
    <script src="./renderer.js"></script>
  </body>
</html>
